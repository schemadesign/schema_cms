<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div>Schema value: <p id="schemaValue"></p></div>
<div>Data id: <p id="dataId"></p></div>
<div id="dataContent"></div>
</body>
</html>

<script>
    const schemaValue = document.getElementById('schemaValue');
    const dataId = document.getElementById('dataId');
    const dataContent = document.getElementById('dataContent');

    window.onload = function() {
        fetch(`http://localhost:8000/public-api/datasources/1`)
            .then(response => response.json())
            .then(data => {
                dataContent.innerText = JSON.stringify(data);
                dataId.innerText = 1;
                schemaValue.innerText = false;
            })
    }

    window.addEventListener("message", function(event) {
        if (event.source != window)
            return;
        schemaObject.setSchemaVariable = event.data.PREVIEW_MODE;
        schemaObject.setDataId = event.data.DATA_ID;

        return fetch(`http://localhost:8000/public-api/datasources/${schemaObject.getDataId}`)
            .then(response => response.json())
            .then(data => {
                dataContent.innerText = JSON.stringify(data);
                dataId.innerText = schemaObject.getDataId;
                schemaValue.innerText = schemaObject.getSchemaVariable;
            })
    }, false);

    const schemaObject = {
        SCHEMA_PREVIEW: null,
        DATA_ID: null,
        get getSchemaVariable() {
            return this.SCHEMA_PREVIEW;
        },
        set setSchemaVariable(schemaPreviewValue) {
            this.SCHEMA_PREVIEW = schemaPreviewValue
        },
        get getDataId() {
            return this.DATA_ID;
        },
        set setDataId(dataId) {
            this.DATA_ID = dataId
        }
    };
</script>
